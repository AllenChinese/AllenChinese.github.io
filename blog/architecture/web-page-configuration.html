<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端页面「配置化」实践 | 周嘉炜</title>
    <meta name="description" content="记录开发中的点点滴滴，攒出一本散文诗">
    <link rel="icon" href="/logo.ico">
    
    <link rel="preload" href="/assets/css/0.styles.20f14837.css" as="style"><link rel="preload" href="/assets/js/app.c77ce8de.js" as="script"><link rel="preload" href="/assets/js/12.3e809ab6.js" as="script"><link rel="prefetch" href="/assets/js/10.10e8e5c1.js"><link rel="prefetch" href="/assets/js/11.4b0373f5.js"><link rel="prefetch" href="/assets/js/13.3ad1fd08.js"><link rel="prefetch" href="/assets/js/14.3435d46c.js"><link rel="prefetch" href="/assets/js/15.73e1c326.js"><link rel="prefetch" href="/assets/js/16.5615dcfc.js"><link rel="prefetch" href="/assets/js/17.a134d57a.js"><link rel="prefetch" href="/assets/js/18.184470f0.js"><link rel="prefetch" href="/assets/js/19.dd78ac1f.js"><link rel="prefetch" href="/assets/js/2.878b12a5.js"><link rel="prefetch" href="/assets/js/20.edd472ca.js"><link rel="prefetch" href="/assets/js/21.15403b92.js"><link rel="prefetch" href="/assets/js/22.2ba2ef66.js"><link rel="prefetch" href="/assets/js/23.cb3fa477.js"><link rel="prefetch" href="/assets/js/24.ead031a1.js"><link rel="prefetch" href="/assets/js/25.40a35296.js"><link rel="prefetch" href="/assets/js/26.ad98b076.js"><link rel="prefetch" href="/assets/js/3.e3bb0a04.js"><link rel="prefetch" href="/assets/js/4.8d93a946.js"><link rel="prefetch" href="/assets/js/5.944f7097.js"><link rel="prefetch" href="/assets/js/6.e325a207.js"><link rel="prefetch" href="/assets/js/7.7199e07d.js"><link rel="prefetch" href="/assets/js/8.65f8acdd.js"><link rel="prefetch" href="/assets/js/9.22359996.js">
    <link rel="stylesheet" href="/assets/css/0.styles.20f14837.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">周嘉炜</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/AllenChinese/zjiawei" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><a href="/essay/" class="nav-link">随笔</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/AllenChinese/zjiawei" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>小程序</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>动画</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>前端整理</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>架构 &amp; 解决方案</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/blog/architecture/web-page-configuration.html" class="active sidebar-link">前端页面「配置化」实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#前端页面「配置化」实践" class="sidebar-link">前端页面「配置化」实践</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#目录" class="sidebar-link">目录</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#什么是页面「配置化」" class="sidebar-link">什么是页面「配置化」</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#page-dom-tree-data" class="sidebar-link">Page = Dom Tree + Data</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#配置化能解决什么" class="sidebar-link">配置化能解决什么</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#业界解决方案分析" class="sidebar-link">业界解决方案分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#阿里飞冰" class="sidebar-link">阿里飞冰</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#百度-h5" class="sidebar-link">百度 H5</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#前端「配置化」的难点" class="sidebar-link">前端「配置化」的难点</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#_1、业务场景" class="sidebar-link">1、业务场景</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#_2、技术" class="sidebar-link">2、技术</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#商业组「配置化」实践" class="sidebar-link">商业组「配置化」实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#_1、系统介绍" class="sidebar-link">1、系统介绍</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#_2、系统分析" class="sidebar-link">2、系统分析</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#api：getpageinfo" class="sidebar-link">API：getPageInfo</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#demo-示例" class="sidebar-link">demo 示例</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#开发中的可说的点" class="sidebar-link">开发中的可说的点</a></li><li class="sidebar-sub-header"><a href="/blog/architecture/web-page-configuration.html#_2-0-规划" class="sidebar-link">2.0 规划</a></li></ul></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>管理</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>我的项目</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>踩坑之旅</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="前端页面「配置化」实践"><a href="#前端页面「配置化」实践" aria-hidden="true" class="header-anchor">#</a> 前端页面「配置化」实践</h2> <div class="tip custom-block"><p class="custom-block-title">博客</p> <p>记录程序生涯的点滴，分享技术实践。</p></div> <h2 id="目录"><a href="#目录" aria-hidden="true" class="header-anchor">#</a> 目录</h2> <p></p><div class="table-of-contents"><ul><li><a href="#前端页面「配置化」实践">前端页面「配置化」实践</a></li><li><a href="#目录">目录</a></li><li><a href="#前言">前言</a></li><li><a href="#什么是页面「配置化」">什么是页面「配置化」</a><ul><li><a href="#page-dom-tree-data">Page = Dom Tree + Data</a></li><li><a href="#配置化能解决什么">配置化能解决什么</a></li></ul></li><li><a href="#业界解决方案分析">业界解决方案分析</a><ul><li><a href="#阿里飞冰-https-alibaba-github-io-ice">阿里飞冰</a></li><li><a href="#百度-h5-https-h5-bce-baidu-com-edit-h5-51c714cb-4518-eb74-01c8-e3bc12f0b9db">百度 H5</a></li></ul></li><li><a href="#前端「配置化」的难点">前端「配置化」的难点</a><ul><li><a href="#_1、业务场景">1、业务场景</a></li><li><a href="#_2、技术">2、技术</a></li></ul></li><li><a href="#商业组「配置化」实践">商业组「配置化」实践</a><ul><li><a href="#_1、系统介绍">1、系统介绍</a></li><li><a href="#_2、系统分析">2、系统分析</a></li><li><a href="#api：getpageinfo">API：getPageInfo</a></li><li><a href="#demo-示例">demo 示例</a></li><li><a href="#开发中的可说的点">开发中的可说的点</a></li><li><a href="#_2-0-规划">2.0 规划</a></li></ul></li></ul></div>
运营：这次专区页面和原先一个项目很相似的，客户希望一周可以发上线<p></p> <pre><code>开发：那个项目不是我开发的，我得重新建项目开发、发布

运营：客户需要快速推广他们的新产品，你们能做到沿用当时项目的布局样式风格，换下里面的内容，快速上线吗

开发：这样啊...容我想想
</code></pre> <blockquote><p>关键词：类似、快速、内容替换</p></blockquote> <h2 id="前言"><a href="#前言" aria-hidden="true" class="header-anchor">#</a> 前言</h2> <p>标题「配置化」设定的是一种页面信息与约定格式数据的映射关系，而数据的来源，则通过人为的编辑生成，少涉及甚至不涉及二次代码编写。
<img src="https://user-gold-cdn.xitu.io/2018/12/23/167db26b1459bc24?w=485&h=300&f=png&s=8173" alt></p> <p>由于人力和功能规划，一期并未引入可视化搭建和多框架扩展。</p> <h2 id="什么是页面「配置化」"><a href="#什么是页面「配置化」" aria-hidden="true" class="header-anchor">#</a> 什么是页面「配置化」</h2> <h3 id="page-dom-tree-data"><a href="#page-dom-tree-data" aria-hidden="true" class="header-anchor">#</a> Page = Dom Tree + Data</h3> <p>前端认为一个页面的组成包含 HTML 结构和数据（元素属性、文本），复杂的动态页面会包含一些逻辑（JavaScript）。把页面按块细分，则可以将一个页面分割成几个独立的区块，每一个区块都可以包含上述的几个要素，如图。</p> <p><img src="https://user-gold-cdn.xitu.io/2018/12/24/167dc046216fd10a?w=650&h=321&f=png&s=14924" alt></p> <p>这样看，页面就变成了有若干个组件按一定顺序组成。而每一个组件则只需关注自身的 HTML、CSS、JS。当组件足够丰富时，我们就可以配置成 n 多种风格的页面。当所有区块都编码完成后，页面的输出，我们就只要关心用到哪些组件，谁在页面上方，谁又在底部，这个 banner 区块需要用 A 图还是 B 图。这个过程的转化，带来了两个提高：</p> <ul><li>1、不关心组件的代码。即无需编程能力。</li> <li>2、一个组件可以用在所有页面，即无需重复造轮子、搬砖。</li></ul> <h3 id="配置化能解决什么"><a href="#配置化能解决什么" aria-hidden="true" class="header-anchor">#</a> 配置化能解决什么</h3> <p>1、快速搭建页面、站点的能力——提高效率</p> <p>2、减少重复轮子的开发——避轻就重</p> <p>3、赋予非技术人员（运营、产品）开发的能力——工作转移</p> <p>4、集成发布部署</p> <p>5、覆盖多种业务场景</p> <h2 id="业界解决方案分析"><a href="#业界解决方案分析" aria-hidden="true" class="header-anchor">#</a> 业界解决方案分析</h2> <h3 id="阿里飞冰"><a href="#阿里飞冰" aria-hidden="true" class="header-anchor">#</a> <a href="https://alibaba.github.io/ice" target="_blank" rel="noopener noreferrer">阿里飞冰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>让<code>前端</code>开发简单而又好</p> <p>海量<code>可复用</code>物料，配套桌面工具极速构建前端应用，<code>效率提升 100%</code></p> <p>飞冰的 <strong>买点</strong> 是辅助开发者快速搭建<code>中后台</code>前端应用，效率提升 100%。</p> <ul><li>零环境搭建，零配置</li> <li>丰富的物料选择</li> <li>开发语言的多样性</li> <li>源码本地化供二次开发，更加的灵活</li> <li>搭配了项目创建到发布的一站式服务外</li> <li>工具本身简单易用</li></ul> <p>我认为飞冰是非常好<code>中后台</code>开发解决方案，让前端开发人员只需关注逻辑层的实现。
<img src="https://user-gold-cdn.xitu.io/2018/12/23/167db71e16952163?w=2546&h=1454&f=png&s=411578" alt></p> <p><img src="https://user-gold-cdn.xitu.io/2018/12/23/167db5073fe8d8e7?w=2474&h=1300&f=png&s=508496" alt></p> <h3 id="百度-h5"><a href="#百度-h5" aria-hidden="true" class="header-anchor">#</a> <a href="https://h5.bce.baidu.com/edit/h5/51c714cb-4518-eb74-01c8-e3bc12f0b9db" target="_blank" rel="noopener noreferrer">百度 H5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>百度 H5 是百度公司推出的<code>移动端 H5 页面</code>快速制作工具平台。</p> <p>只要您的百度账号登录百度 H5 平台，就可以自由地开启您的 H5 之旅啦！</p> <p>百度 H5 的 <strong>买点</strong> 是无需你有开发经验，人人都能定制 H5 页面。</p> <ul><li><p>可视化地构建并发布专属 H5 页面</p></li> <li><p>具备强大的编辑功能：</p> <ul><li>支持各种常用编辑快捷键，复制／粘贴／撤销／重做／上下左右移动／保存 流畅进行，无需鼠标点点点；</li> <li>提供智能参考线和多种对齐控制，方便控制组件居中和对齐；</li> <li>元件次序、编组、时间线、组合动画，让您的 H5 与众不同。</li></ul></li> <li><p>支持文本、媒体（含音频，图片，视频）、形状、表单、图表、插件六大类组件</p></li> <li><p>运营实战的数百套创意模板</p></li></ul> <p><img src="https://user-gold-cdn.xitu.io/2018/12/23/167db738ef39fc1e?w=1323&h=790&f=png&s=450488" alt></p> <h2 id="前端「配置化」的难点"><a href="#前端「配置化」的难点" aria-hidden="true" class="header-anchor">#</a> 前端「配置化」的难点</h2> <p>这里从两个纬度出发去说说：<strong>业务场景</strong> 和 <strong>技术</strong></p> <h3 id="_1、业务场景"><a href="#_1、业务场景" aria-hidden="true" class="header-anchor">#</a> 1、业务场景</h3> <p>页面「配置化」系统其实是一套快速业务开发的工具，那相比于 Vue、React 两者可取其一的情况，为什么飞冰、百度 H5 却不行。或者说当我需要开发中后台系统的时候，我会选择飞冰，当我想要发布一个活动宣传时，我会选择百度 H5。为什么多种不同的业务场景，不能使用同一套「配置化」系统？</p> <ul><li>不同业务存在壁垒，横向扩展飞冰去支持百度 H5 的场景，会导致整个工具非常臃肿、繁琐；但纵向依靠技术去平衡两种场景，技术难度可能会是 2 的次方。</li></ul> <p><code>观点：配置化应该专注于一个业务场景，或者垂直领域的几个类似业务，例如医疗行业、电商类小程序、中后台应用等</code></p> <h3 id="_2、技术"><a href="#_2、技术" aria-hidden="true" class="header-anchor">#</a> 2、技术</h3> <p>支撑前端「配置化」系统所需要的技术也相对复杂，除了从编辑配置到输出页面的逻辑走通外，可能还需要集成一些发布部署、源码本地化等功能。更需要维护大量的模板、物料、区块来满足使用者的个性需求。系统本身的交互开发，也是高于一般系统的。所以制作一个完整好用的「配置化」系统，需要大量的人力和时间，飞冰也是在阿里迭代了两年才有现在的效果。所以，配置化的工具，不像前端的一些工具类库一样各种轮子，甚至人手一套。</p> <p><code>观点：当现有技术、资源紧缺的时候，先专注于编辑配置到输出页面的逻辑走通，通过不断迭代的方式，优化工具。达到配置化对于业务线产品输出的效率</code></p> <h2 id="商业组「配置化」实践"><a href="#商业组「配置化」实践" aria-hidden="true" class="header-anchor">#</a> 商业组「配置化」实践</h2> <h3 id="_1、系统介绍"><a href="#_1、系统介绍" aria-hidden="true" class="header-anchor">#</a> 1、系统介绍</h3> <p><img src="https://user-gold-cdn.xitu.io/2018/12/23/167dbc3aae572d41?w=1830&h=729&f=png&s=79663" alt></p> <ul><li><p>配置中心后台</p> <p>提供商业项目管理及页面的配置编辑，主要给后端提供页面信息、区块信息、资源信息等数据存库，数据供 Node 层页面渲染。</p> <pre><code> Vue + iView
</code></pre></li> <li><p>资源开发、发布层</p> <p>包含区块中心所有区块的 css、js、图片等资源（common），并且可供开发者开发、发布每个项目的个性资源（self）。区分通用和私有是为了,在区块中心不能覆盖所有场景时，具备<code>专区个性化定制需求</code>的能力。</p> <pre><code> 商业组多页面模板
  .
  ├── src
  │   ├── assets                          // 通用、私有项目资源目录
  │   │   ├── mobile                      // common 移动端资源
  │   │   ├── pc                          // common web 端资源
  │   │   └── pedemo                      // self 私有项目资源，以项目名命名文件名
  │   ├── components                      // common 项目组件
  │   │   ├── survey
  │   ├── componentsCss                   // common base css
  │   │   ├── animation
  │   │   ├── common
  │   │   └── mixins
  │   ├── config
  │   │   └── apis.js
  │   ├── css
  │   │   ├── common.less                 // common css
  │   │   ├── projectCss                  // self 私有项目样式，以项目名命名文件名
  │   │   ├── survey.less                 // common survey component css
  │   ├── entries                         // 通用、私有项目都需要建一个入口地址，发布资源需要
  │   │   ├── common
  │   │   ├── index
  │   │   └── pedemo                      // self 私有项目的 js 写在对应文件的 index.js 中
  │   ├── js                              // common components js
  │   │   ├── common.js
  │   │   ├── survey.js
  │   ├── layout
  │   │   ├── default.html
  │   │   └── default.js
  │   └── utils                           // utils
  │       ├── api.js
  │       ├── getToken.js
  │       ├── globalFunctionConfig.js
  └── static
</code></pre></li> <li><p>Node 页面渲染中间层</p> <p>提供页面数据的请求，获取 page_data 和 block_data 的数据，并通过定义的 block_style 属性，匹配对应的区块，按照一定顺序渲染页面。Node 层也提供了专区页的路由配置，以及一些 404, 500 的页面模板。</p> <pre><code> egg.js + Nunjucks
</code></pre></li> <li><p>商业基础组件库</p> <p>结合以往项目设计，总结开发的一套适用于商业项目的组件库，现有 30 余中组件（区块）。作为配置中心的区块样式、功能样本。</p> <pre><code>商业组多页面模板
</code></pre></li></ul> <h3 id="_2、系统分析"><a href="#_2、系统分析" aria-hidden="true" class="header-anchor">#</a> 2、系统分析</h3> <ul><li>2.1 Node (egg) 端如何用一个接口，输出页面</li></ul> <p><img src="https://user-gold-cdn.xitu.io/2018/12/26/167eb0238164d2d3?w=1716&h=882&f=png&s=182255" alt></p> <h3 id="api：getpageinfo"><a href="#api：getpageinfo" aria-hidden="true" class="header-anchor">#</a> <code>API：getPageInfo</code></h3> <pre><code>关键字：router、cc、Controller、server、view
</code></pre> <ul><li><strong>router</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> app <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> router<span class="token punctuation">,</span> controller<span class="token punctuation">:</span> <span class="token punctuation">{</span> config <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> app
    <span class="token comment">// 配置中心项目</span>
    <span class="token comment">// 首页</span>
    router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/:project/cc/'</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>custom<span class="token punctuation">)</span>
    <span class="token comment">// 基础页</span>
    router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/:project/cc/:page'</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>custom<span class="token punctuation">)</span>
    <span class="token comment">// 详情页</span>
    router<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/:project/cc/:page/:id'</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>detail<span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>只要满足配置中心的页面路由，包含 <code>cc</code> 都会进入到 Controller 的 custom 方法中，<code>cc</code> 是代码页面走配置中心的标志。</p> <ul><li><strong>Controller</strong></li></ul> <p><img src="https://user-gold-cdn.xitu.io/2018/12/26/167eb1244a60615f?w=1266&h=1566&f=png&s=351961" alt></p> <p>Controller 主要负责的是向后端发送请求（getPageInfo），传递的参数保证定位到唯一的页面：project、page、query，接口返回约定格式的页面信息。如果当前路由映射的页面，没有在配置中心配置，则接口返回空，这时会渲染 404.nj，否则接口会返回 <code>page_data</code> &amp; <code>block_data</code>，利用 renderPage 方法进行页面组装。</p> <p><img src="https://user-gold-cdn.xitu.io/2018/12/26/167eb12b5a1bacb2?w=1448&h=1566&f=png&s=343737" alt></p> <p>渲染页面结构的renderPage 方法，按顺序有以下几个步骤：</p> <pre><code>1、layout：&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body class=&quot;page-&quot; data-project=&quot;&quot;&gt;&lt;/body&lt;/html&gt;
2、head：渲染页面 head
3、blocks：页面中配置的区块按顺序渲染结构
4、body：将所有区块拼成的 HTML，放进 body 中
5、add alljs：将页面的 js 拼接到 body 最后
6、ctx.body = $html 渲染出页面
</code></pre> <ul><li><strong>server</strong></li></ul> <p><img src="https://user-gold-cdn.xitu.io/2018/12/26/167eb15ce6835cb8?w=1380&h=1530&f=png&s=314193" alt></p> <p>发送的请求，需要携带浏览器 cookie 时, 则需要配置如图中 headers。</p> <ul><li><strong>view</strong></li></ul> <p>区块左图右文1 <code>style: cmslist_horizontal_1</code> <img src="https://user-gold-cdn.xitu.io/2018/12/26/167eb3385713b11b?w=1970&h=1422&f=png&s=387023" alt></p> <h3 id="demo-示例"><a href="#demo-示例" aria-hidden="true" class="header-anchor">#</a> demo 示例</h3> <p>制作一个 pedemo 示例</p> <h3 id="开发中的可说的点"><a href="#开发中的可说的点" aria-hidden="true" class="header-anchor">#</a> 开发中的可说的点</h3> <ul><li>vue-cli 3.x env 文件与环境设置
<img src="https://user-gold-cdn.xitu.io/2018/12/31/16802d71ba6877d7?w=354&h=360&f=png&s=19012" alt></li></ul> <p>新的脚手架找不到 <code>webpack</code> 相关的配置文件了，原因是 <code>vue-vli 3</code> 给我们提供了一种开箱即用的模式，你无需配置 <code>webpack</code> 就可以运行项目，并且它提供了一个 <code>vue.config.js</code> 文件来满足开发者对其封装的 <code>webpack</code> 默认配置的修改。</p> <p>我们的项目一般静态资源和 <code>API</code> 地址会有测试线和线上区分，如何通过 <code>env</code> 文件配合我们的发布系统来进行自动切换。</p> <p>1、在根目录中创建以下形似的文件进行不同环境下的变量配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token punctuation">[</span>mode<span class="token punctuation">]</span>  #只在指定模式<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>下被载入
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>2、比如我们的发布系统中测试打包的命令：<code>dxybuild:test</code>，那我们可以创建 <code>.env.dxybuild:test</code> 文件，表明当我们进行测试线打包时，该文件中的环境变量配置会被载入。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token constant">VUE_APP_ENV</span><span class="token operator">=</span>dynamic
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>3、在 <strong>vue.config.js</strong> 中通过 <code>process.env.[name]</code> 访问这些变量</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token comment">// vue.config.js</span>
    <span class="token keyword">const</span> dxyAssetsUrl <span class="token operator">=</span> <span class="token string">'//assets.dxycdn.com/gitrepo/business-admin'</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 部署应用包时的资源基本 URL</span>
         baseUrl<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_ENV</span> <span class="token operator">===</span> <span class="token string">'dynamic'</span> <span class="token operator">?</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dxyAssetsUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_dynamic/dist`</span></span>
            <span class="token punctuation">:</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dxyAssetsUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/dist`</span></span> <span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>4、当然也得修改 <code>package.json</code> 中的 <code>serve</code> 脚本的命令</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>    <span class="token string">&quot;dxybuild:test&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;vue-cli-service build --mode dxybuild:test&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-0-规划"><a href="#_2-0-规划" aria-hidden="true" class="header-anchor">#</a> 2.0 规划</h3> <ul><li>现有区块优化，根据这一年的商业项目，和设计师总结更多符合业务的功能组件，丰富区块中心</li> <li>可视化配置页面功能，所见即所得的配置体验，更好的赋能运营</li> <li>多框架模板扩展，<code>Vue</code> <code>React</code></li></ul></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">文档更新时间: </span> <span class="time">12/31/2018, 2:58:09 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/performance/p--RAIL.html" class="prev">
          浅谈性能标准与优化
        </a></span> <span class="next"><a href="/blog/manager/m-a-project-life-circle.html">
          一个项目的生命周期
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.c77ce8de.js" defer></script><script src="/assets/js/12.3e809ab6.js" defer></script>
  </body>
</html>
